---
categories:
  - "[[Work]]"
created: 2025-08-26
product:
component:
tags: []
---

|   |
|---|
|**File: /etc/apache2/sites-enabled/raise2-le-ssl.conf**|
|```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.portal.raise-science.eu:443\>  <br>        ServerName develop.portal.raise-science.eu  <br>          <br>        DocumentRoot /var/www/raise-portal-dev/browser/  <br>          <br>        \<Directory /var/www/raise-portal-dev/browser/\>  <br>            AllowOverride All  <br>                         <br>            RewriteEngine On  <br>            RewriteBase /<br>```<br><br>  <br><br>```<br>            # Fix to Angular issue where redirection from DOI would result in 404 Not Found  <br>            RewriteCond %{REQUEST_FILENAME} !-f  <br>            RewriteCond %{REQUEST_FILENAME} !-d  <br>            RewriteRule ^ index.html [L]  <br>        \</Directory\><br>```<br><br>  <br><br>```<br>        RewriteEngine on<br>```<br><br>  <br><br>```<br>RewriteRule ^/rai-finder/(.+)$ - [E=PID:$1]<br>```<br><br>  <br><br>```<br>RewriteCond %{HTTP:Accept} application/vnd\.datacite\.datacite\+json [NC]  <br>RewriteRule ^/rai-finder/(.+)$ [https://develop.api.portal.raise-science.eu/fair-pid/resource/$1](https://develop.api.portal.raise-science.eu/fair-pid/resource/$1) [R=302,L,NE]  <br>          <br>        #Workaround for apache quirk: see [https://stackoverflow.com/questions/3050444/when-setting-environment-variables-in-apache-rewriterule-directives-what-causes](https://stackoverflow.com/questions/3050444/when-setting-environment-variables-in-apache-rewriterule-directives-what-causes)  <br>        RewriteCond %{ENV:REDIRECT_PID} !^$  <br>RewriteRule .* - [E=PID:%{ENV:REDIRECT_PID}]  <br>          <br>        # Link header is only applied when redirection does not happen (meaning when the page is served normally)  <br>        Header set Link "\<[https://develop.api.portal.raise-science.eu/fair-pid/linksets/linksets.json/%{PID}e](https://develop.api.portal.raise-science.eu/fair-pid/linksets/linksets.json/%25%7bPID%7de)\>; rel=\"describedby\"" env=PID<br>```<br><br>  <br><br>```<br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>SSLCertificateFile /etc/letsencrypt/live/develop.portal.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.portal.raise-science.eu/privkey.pem  <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.api.portal.raise-science.eu:443\>  <br>        ServerName develop.api.portal.raise-science.eu  <br>          <br>       # SSL Certificates  <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>        SSLCertificateFile /etc/letsencrypt/live/develop.portal.raise-science.eu/fullchain.pem  <br>        SSLCertificateKeyFile /etc/letsencrypt/live/develop.portal.raise-science.eu/privkey.pem<br>```<br><br>  <br><br>```<br>        # Handle WebSocket upgrade requests first  <br>        RewriteEngine On  <br>        RewriteCond %{HTTP:Upgrade} websocket [NC]  <br>        RewriteCond %{HTTP:Connection} \bupgrade\b [NC]  <br>        RewriteRule ^/(.*) ws://127.0.0.1:5000/$1 [P,L]<br>```<br><br>  <br><br>```<br>        # Proxy all other standard HTTP requests  <br>        ProxyPass / [http://127.0.0.1:5000/](http://127.0.0.1:5000/)  <br>        ProxyPassReverse / [http://127.0.0.1:5000/](http://127.0.0.1:5000/)  <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.registration.raise-science.eu:443\>  <br>        ServerName develop.registration.raise-science.eu  <br>          <br>        ProxyPass / [http://127.0.0.1:3000/](http://127.0.0.1:3000/)  <br>    ProxyPassReverse / [http://127.0.0.1:3000/](http://127.0.0.1:3000/)<br>```<br><br>  <br><br>```<br>        RewriteEngine on  <br>          <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>SSLCertificateFile /etc/letsencrypt/live/develop.registration.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.registration.raise-science.eu/privkey.pem          <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.raise-science.eu:443\>  <br>        ServerName develop.raise-science.eu  <br>          <br>       DocumentRoot /var/www/  <br>          <br>        \<Directory "/var/www/"\>  <br>            AllowOverride All  <br>        \</Directory\><br>```<br><br>  <br><br>```<br>        RewriteEngine on  <br>          <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>        SSLCertificateFile /etc/letsencrypt/live/develop.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.raise-science.eu/privkey.pem  <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.plagiarism.raise-science.eu:443\>  <br>        ServerName develop.plagiarism.raise-science.eu  <br>          <br>        ProxyPass / [http://127.0.0.1:8080/](http://127.0.0.1:8080/)  <br>    ProxyPassReverse / [http://127.0.0.1:8080/](http://127.0.0.1:8080/)<br>```<br><br>  <br><br>```<br>        RewriteEngine on  <br>          <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>SSLCertificateFile /etc/letsencrypt/live/develop.plagiarism.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.plagiarism.raise-science.eu/privkey.pem       <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.script.raise-science.eu:443\>  <br>        ServerName develop.script.raise-science.eu  <br>          <br>        ProxyPass / [http://127.0.0.1:5001/](http://127.0.0.1:5001/)  <br>    ProxyPassReverse / [http://127.0.0.1:5001/](http://127.0.0.1:5001/)<br>```<br><br>  <br><br>```<br>        RewriteEngine on  <br>          <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>SSLCertificateFile /etc/letsencrypt/live/develop.script.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.script.raise-science.eu/privkey.pem       <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.evaluator.raise-science.eu:443\>  <br>        ServerName develop.evaluator.raise-science.eu  <br>          <br>        ProxyPass / [http://127.0.0.1:8083/](http://127.0.0.1:8083/)  <br>    ProxyPassReverse / [http://127.0.0.1:8083/](http://127.0.0.1:8083/)<br>```<br><br>  <br><br>```<br>        RewriteEngine on  <br>          <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>SSLCertificateFile /etc/letsencrypt/live/develop.evaluator.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.evaluator.raise-science.eu/privkey.pem      <br>    \</VirtualHost\>  <br>\</IfModule\><br>```<br><br>  <br><br>```<br>\<IfModule mod_ssl.c\>  <br>    \<VirtualHost develop.contracts.raise-science.eu:443\>  <br>        ServerName develop.contracts.raise-science.eu  <br>          <br>        ProxyPass / [http://127.0.0.1:4433/](http://127.0.0.1:4433/)  <br>    ProxyPassReverse / [http://127.0.0.1:4433/](http://127.0.0.1:4433/)<br>```<br><br>  <br><br>```<br>        RewriteEngine on  <br>          <br>        Include /etc/letsencrypt/options-ssl-apache.conf  <br>SSLCertificateFile /etc/letsencrypt/live/develop.contracts.raise-science.eu/fullchain.pem  <br>SSLCertificateKeyFile /etc/letsencrypt/live/develop.contracts.raise-science.eu/privkey.pem       <br>    \</VirtualHost\>  <br>\</IfModule\><br>```|
   

|   |
|---|
|**This is the code Iput in htaccess and removed from Evelina**|
|```<br># Angular prerender/SPA with future SSR support  <br># Place under /var/www/raise-portal-dev/browser/.htaccess  <br># Required: a2enmod rewrite headers  <br>Options -MultiViews  <br>\<IfModule mod_rewrite.c\>  <br>  RewriteEngine On  <br>  RewriteBase /  <br>  # Force HTTPS  <br>  RewriteCond %{HTTPS} !=on  <br>  RewriteRule ^ [https://%{HTTP_HOST}%{REQUEST_URI}](https://%{HTTP_HOST}%{REQUEST_URI}) [R=301,L]  <br>  # Serve existing files/dirs  <br>  RewriteCond %{REQUEST_FILENAME} -f [OR]  <br>  RewriteCond %{REQUEST_FILENAME} -d  <br>  RewriteRule ^ - [L]  <br>  # ------------------------------------  <br>  # rai-finder PID capture  <br>  # runs before fallback  <br>  # ------------------------------------  <br>  RewriteRule ^rai-finder/(.+)$ - [E=PID:$1]  <br>  # If client requests DataCite JSON â†’ redirect to API  <br>  RewriteCond %{HTTP:Accept} application/vnd\.datacite\.datacite\+json [NC]  <br>  RewriteRule ^rai-finder/(.+)$ [https://develop.api.portal.raise-science.eu/fair-pid/resource/$1](https://develop.api.portal.raise-science.eu/fair-pid/resource/$1) [R=302,L,NE]  <br>  # Workaround for apache quirk: see [https://stackoverflow.com/questions/3050444/when-setting-environment-variables-in-apache-rewriterule-directives-what-causes](https://stackoverflow.com/questions/3050444/when-setting-environment-variables-in-apache-rewriterule-directives-what-causes)  <br>  RewriteCond %{ENV:REDIRECT_PID} !^$  <br>  RewriteRule .* - [E=PID:%{ENV:REDIRECT_PID}]  <br>  # ------------------------------------  <br>  # (FUTURE) SSR ROUTES (proxy to Node)  <br>  #    For example Node SSR @ [http://127.0.0.1:4000](http://127.0.0.1:4000),  <br>  #    Uncomment the following and add routes  <br>  #    Not sure about this!  <br>  #  Enable using:  <br>  #          sudo a2enmod proxy proxy_http  <br>  #          sudo systemctl reload apache2  <br>  # ------------------------------------  <br>  # RewriteRule ^(news/\|blog/\|ssr/).* [http://127.0.0.1:4000%{REQUEST_URI}](http://127.0.0.1:4000%{REQUEST_URI}) [P,QSA,L,E=FROM_SSR:1]  <br>  # RewriteRule ^ssr$ [http://127.0.0.1:4000/](http://127.0.0.1:4000/) [P,QSA,L,E=FROM_SSR:1]  <br>  # If there is a prerendered route directory, serve its index.html  <br>  RewriteCond %{REQUEST_URI} !\.[^./]+$       [NC]  <br>  RewriteCond %{REQUEST_FILENAME}/index.html -f  <br>  RewriteRule ^ %{REQUEST_URI}/index.html [QSA,PT,L]  <br>  # SPA fallback to main index.html  <br>  RewriteCond %{REQUEST_URI} !\.[^./]+$       [NC]  <br>  RewriteRule ^ index.html [QSA,PT,L]  <br>  # Tag hashed assets for immutable caching (e.g., main.abc12345.js)  <br>  RewriteCond %{REQUEST_URI} \.[0-9a-f]{8,}\. [OR]  <br>  RewriteCond %{REQUEST_URI} [._-][0-9a-f]{8,}(?:\.\|$)  <br>  RewriteRule ^ - [E=IS_HASHED_ASSET:1]  <br>\</IfModule\>  <br>\<IfModule mod_headers.c\>  <br>  # Never cache ANY HTML (index + prerendered route HTMLs)  <br>  \<FilesMatch "\.html$"\>  <br>    Header set Cache-Control "no-store, no-cache, must-revalidate"  <br>    Header set Pragma "no-cache"  <br>    Header set Expires "0"  <br>  \</FilesMatch\>  <br>  # Never cache Angular SW artifacts  <br>  \<FilesMatch "(^\|/)(ngsw\.json\|ngsw-worker\.js\|safety-worker\.js\|worker-basic\.min\.js)$"\>  <br>    Header set Cache-Control "no-store, no-cache, must-revalidate"  <br>    Header set Pragma "no-cache"  <br>    Header set Expires "0"  <br>  \</FilesMatch\>  <br>  # Long cache for hashed assets - 1 year + immutable  <br>  Header set Cache-Control "public, max-age=31536000, immutable" env=IS_HASHED_ASSET  <br>  # Short cache for non-hashed statics (optional)  <br>  \<FilesMatch "\.(?:png\|jpg\|jpeg\|gif\|webp\|svg\|ico\|css\|js\|woff2?\|ttf\|eot)$"\>  <br>    Header set Cache-Control "public, max-age=3600" env=!IS_HASHED_ASSET  <br>  \</FilesMatch\>  <br>    <br>  # ------------------------------------  <br>  # Custom Link header is only applied when there is PID and redirection does not happen (meaning when the page is served normally)  <br>  # ------------------------------------  <br>  Header set Link "\<[https://develop.api.portal.raise-science.eu/fair-pid/linksets/linksets.json/%{PID}e](https://develop.api.portal.raise-science.eu/fair-pid/linksets/linksets.json/%{PID}e)\>; rel=\"describedby\"" env=PID  <br>      <br>\</IfModule\><br>```|