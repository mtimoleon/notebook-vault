---
created: 2026-01-13
---

Διαβάζω τις αλλαγές του PR (diff vs `origin/develop`) και να τα βασικά ευρήματα.  
**Findings**  
- [x] Critical: Το `IBlockchainService` κάνει inject `HttpClient`, αλλά δεν υπάρχει registration για typed/untyped client. Αυτό θα σκάσει στο DI (`Unable to resolve service for type HttpClient`) όταν δημιουργηθεί το `BlockchainService`. Δες Program.cs (lines 117-131) και BlockchainService.cs (lines 16-30).  
- [x] High: Η `RegistrationService` υποθέτει ότι υπάρχουν πάντα `ExperimentRegistration` και `Result`. Σε παλιότερα/ασυνεπή δεδομένα (ή αν δεν δημιουργηθούν σωστά) θα πέσει `NullReference` στα `experiment.ExperimentRegistration.Update...` και `experiment.Result...`. Δες RegistrationService.cs (lines 86-154).  
- [x] High: Στο `UpdateExperimentStatusAsync`, όταν έρθει status `RegistrationInProgress`, γίνεται πάντα `AddResult` και `AddExperimentRegistration`. Αν το node ξαναστείλει το ίδιο status (retry/duplicate delivery), θα πετάξει `ExperimentResultAlreadyExists` ή `ExperimentRegistrationAlreadyExists`. Δες NodeService.cs (lines 141-156).  
- [x] Medium: Στο error handling του Datacite, αν το `ReadFromJsonAsync` επιστρέψει `null` (ή `Errors` είναι `null`), γίνεται `NullReference` πριν το guard. Δες DatacitePidProviderService.cs (lines 445-456).  
- [x] Low: Το μήνυμα στο `PidError.TransactionIdGenerationFailedError` λέει “RAI PID” αντί για “Transaction ID”. Δες PidError.cs (line 11).  
**Open questions / assumptions**

- Υποθέτω ότι όλα τα υπάρχοντα experiments σε `RegistrationInProgress` έχουν ήδη `Result` + `ExperimentRegistration`. Αν όχι, χρειάζεται migration/backfill ή defensive guards.
- Το Fabric gateway επιστρέφει πάντα σκέτο transaction id στο body; αν επιστρέφει JSON, το `ReadAsStringAsync` μπορεί να χρειάζεται parsing.

**Change summary**

- Μεταφορά της registration ροής σε background `RegistrationService`, νέα Blockchain integration, νέες ειδοποιήσεις/email για αποτυχία registration, και πιο “graceful” Datacite error handling.

**Suggested next steps**

- Προσθήκη typed `AddHttpClient\<IBlockchainService, BlockchainService\>()` ή αλλαγή σε `IHttpClientFactory`.
- Guards/ιδιότητες idempotency για `AddResult` και `AddExperimentRegistration`, και για `RegistrationService` όταν λείπουν `Result/ExperimentRegistration`.
- Test coverage για registration background flow (success/failure + retry) και για Datacite “already exists” fallback.